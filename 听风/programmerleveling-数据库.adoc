== 数据库
关系型数据库主要有三个：Oracle、MySQL 和 Postgres。

在这里，我们只讨论越来越主流的 MySQL 数据库。首先，我们要了解数据库的一些实现原理和内存的一些细节，然后我们要知道数据的高可用和数据复制这些比较重要的话题，了解一下关系型数据库的一些实践和难点。然后，我们会进入到 NoSQL 数据库的学习。

NoSQL 数据库千奇百怪，其主要是解决了关系型数据库中的各种问题。第一个大问题就是数据的 Schema 非常多，用关系型数据库来表示不同的 Data Schema 是非常笨拙的，所以要有不同的数据库（如时序型、键值对型、搜索型、文档型、图结构型等）。另一个大问题是，关系型数据库的 ACID 是一件很讨厌的事，这极大地影响了数据库的性能和扩展性，所以 NoSQL 在这上面做了相应的妥协以解决大规模伸缩的问题。

对于一个程序员，你可能觉得数据库的事都是 DBA 的事，然而我想告诉你你错了，这些事才真正是程序员的事。因为程序是需要和数据打交道的，所以程序员或架构师不仅需要设计数据模型，还要保证整体系统的稳定性和可用性，数据是整个系统中关键中的关键。所以，作为一个架构师或程序员，你必须了解最重要的数据存储——数据库。

=== 关系型数据库
如果你要玩 Oracle，我这里只推荐一本书《Oracle Database 9i/10g/11g 编程艺术》，无论是开发人员还是 DBA，它都是必读的书。这本书的作者是 Oracle 公司的技术副总裁托马斯 · 凯特（Thomas Kyte），他也是世界顶级的 Oracle 专家。这本书中深入分析了 Oracle 数据库体系结构，包括文件、内存结构以及构成 Oracle 数据库和实例的底层进程，利用具体示例讨论了一些重要的数据库主题，如锁定、并发控制、事务等。同时分析了数据库中的物理结构，如表、索引和数据类型，并介绍采用哪些技术能最优地使用这些物理结构。

学习 MySQL，首先一定是要看 https://dev.mysql.com/doc/[MySQL 官方手册]。

然后，官方还有几个 PPT 也要学习一下：

* https://www.mysql.com/cn/why-mysql/presentations/tune-mysql-queries-performance/[How to Analyze and Tune MySQL Queries for Better Performance]

* https://www.mysql.com/cn/why-mysql/presentations/mysql-performance-tuning101/[MySQL Performance Tuning 101]

* https://www.mysql.com/cn/why-mysql/presentations/mysql-performance-sys-schema/[MySQL Performance Schema & Sys Schema]

* https://www.mysql.com/cn/why-mysql/presentations/mysql-performance-tuning-best-practices/[MySQL Performance: Demystified Tuning & Best Practices]

* https://www.mysql.com/cn/why-mysql/presentations/mysql-security-best-practices/[MySQL Security Best Practices]

* https://www.mysql.com/cn/why-mysql/presentations/mysql-cluster-deployment-best-practices/[MySQL Cluster Deployment Best Practices]

* https://www.mysql.com/cn/why-mysql/presentations/mysql-high-availability-innodb-cluster/[MySQL High Availability with InnoDB Cluster]

* 然后推荐《高性能 MySQL》，这本书是 MySQL 领域的经典之作，拥有广泛的影响力。不但适合数据库管理员（DBA）阅读，也适合开发人员参考学习。不管是数据库新手还是专家，都能从本书中有所收获。

* 如果你对 MySQL 的内部原理有兴趣的话，可以看一下这本书《MySQL 技术内幕：InnoDB 存储引擎》。当然，还有官网的 https://dev.mysql.com/doc/internals/en/[MySQL Internals Manual] 。

* 数据库的索引设计和优化也是非常关键的，这里还有一本书《数据库的索引设计与优化》也是很不错的。虽然不是讲 MySQL 的，但是原理都是相通的。这也是上面推荐过的《高性能 MySQL》在其索引部分推荐的一本好书。

    你千万不要觉得只有做数据库你才需要学习这种索引技术。不是的！在系统架构上，在分布式架构中，索引技术也是非常重要的。这本书对于索引性能进行了非常清楚的估算，不像其它书中只是模糊的描述，你一定会收获很多。
    
下面还有一些不错的和 MySQL 相关的文章。

* http://blog.codinglabs.org/articles/theory-of-mysql-index.html[MySQL 索引背后的数据结构及算法原理]

* https://medium.com/@kousiknath/data-structures-database-storage-internals-1f5ed3619d43[Some study on database storage internals]

* https://medium.com/@Pinterest_Engineering/sharding-pinterest-how-we-scaled-our-mysql-fleet-3f341e96ca6f[Sharding Pinterest: How we scaled our MySQL fleet]

* https://www.mysql.com/cn/why-mysql/white-papers/mysql-guide-to-high-availability-solutions/[Guide to MySQL High Availability]

* https://dzone.com/articles/choosing-mysql-high-availability-solutions[Choosing MySQL High Availability Solutions]

* https://mariadb.com/sites/default/files/content/Whitepaper_High_availability_with_MariaDB-TX.pdf[High availability with MariaDB TX: The definitive guide]

最后，还有一个 MySQL 的资源列表 https://shlomi-noach.github.io/awesome-mysql/[Awesome MySQL]，这个列表中有很多的工具和开发资源，可以帮助你做很多事。

MySQL 有两个比较有名的分支，一个是 Percona，另一个是 MariaDB，其官网上的 Resources 页面中有很多不错的资源和文档，可以经常看看。 https://www.percona.com/resources[Percona Resources]、 https://mariadb.com/resources[MariaDB Resources] ，以及它们的开发博客中也有很多不错的文章，分别为 https://www.percona.com/blog/[Percona Blog] 和 https://mariadb.com/resources/blog[MariaDB Blog]。

然后是关于 MySQL 的一些相关经验型的文章。

* https://www.percona.com/live/mysql-conference-2015/sessions/bookingcom-evolution-mysql-system-design[Booking.com: Evolution of MySQL System Design] ，Booking.com 的 MySQL 数据库使用的演化，其中有很多不错的经验分享，我相信也是很多公司会遇到的的问题。

* https://medium.com/airbnb-engineering/tracking-the-money-scaling-financial-reporting-at-airbnb-6d742b80f040[Tracking the Money - Scaling Financial Reporting at Airbnb] ，Airbnb 的数据库扩展的经验分享。

* https://eng.uber.com/mysql-migration/[Why Uber Engineering Switched from Postgres to MySQL] ，无意比较两个数据库谁好谁不好，推荐这篇 Uber 的长文，主要是想让你从中学习到一些经验和技术细节，这是一篇很不错的文章。

关于 MySQL 的集群复制，下面有这些文章供你学习一下，都是很不错的实践性比较强的文章：

* https://engineering.imvu.com/2013/01/09/monitoring-delayed-replication-with-a-focus-on-mysql/[Monitoring Delayed Replication, With A Focus On MySQL]

* https://githubengineering.com/mitigating-replication-lag-and-reducing-read-load-with-freno/[Mitigating replication lag and reducing read load with freno]

另外，Booking.com 给了一系列的文章，你可以看看：

* https://medium.com/booking-com-infrastructure/better-parallel-replication-for-mysql-14e2d7857813[Better Parallel Replication for MySQL]

* https://medium.com/booking-com-infrastructure/evaluating-mysql-parallel-replication-part-2-slave-group-commit-459026a141d2[Evaluating MySQL Parallel Replication Part 2: Slave Group Commit]

* https://medium.com/booking-com-infrastructure/evaluating-mysql-parallel-replication-part-3-benchmarks-in-production-db5811058d74[Evaluating MySQL Parallel Replication Part 3: Benchmarks in Production]

* https://medium.com/booking-com-infrastructure/evaluating-mysql-parallel-replication-part-4-more-benchmarks-in-production-49ee255043ab[Evaluating MySQL Parallel Replication Part 4: More Benchmarks in Production]

* https://medium.com/booking-com-infrastructure/evaluating-mysql-parallel-replication-part-4-annex-under-the-hood-eb456cf8b2fb[Evaluating MySQL Parallel Replication Part 4, Annex: Under the Hood]

对于 MySQL 的数据分区来说，还有下面几篇文章你可以看看:

* https://stackoverflow.com/questions/5541421/mysql-sharding-approaches[StackOverflow: MySQL sharding approaches?]

* https://www.percona.com/blog/2009/08/06/why-you-dont-want-to-shard/[Why you don’t want to shard]

* https://www.percona.com/sites/default/files/presentations/How%20to%20Scale%20Big%20Data%20Applications.pdf[How to Scale Big Data Applications]

* https://www.percona.com/blog/2016/08/30/mysql-sharding-with-proxysql/[MySQL Sharding with ProxySQL]

然后，再看看各个公司做 MySQL Sharding 的一些经验分享:

* https://devs.mailchimp.com/blog/using-shards-to-accommodate-millions-of-users/[MailChimp: Using Shards to Accommodate Millions of Users]

* https://eng.uber.com/schemaless-rewrite/[Uber: Code Migration in Production: Rewriting the Sharding Layer of Uber’s Schemaless Datastore]

* https://instagram-engineering.com/sharding-ids-at-instagram-1cf5a71e5a5c[Sharding & IDs at Instagram]

* https://medium.com/airbnb-engineering/how-we-partitioned-airbnb-s-main-database-in-two-weeks-55f7e006ff21[Airbnb: How We Partitioned Airbnb’s Main Database in Two Weeks]


